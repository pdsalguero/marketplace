generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  ads      Ad[]
  name     String? // üëà nuevo campo opcional
}

enum Category {
  AUTOS
  INMUEBLES
  ELECTRONICA
  HOGAR
  EMPLEO
  SERVICIOS
  MODA
  MASCOTAS
  OTROS
}

enum Transmission {
  MANUAL
  AUTOMATIC
}

enum Fuel {
  GASOLINE
  DIESEL
  EV
  HYBRID
}

// --- NUEVO: tablas de taxonom√≠a ---
model CategoryNode {
  id       Int            @id @default(autoincrement())
  key      String         @unique // p.ej. "VEHICULOS" o "AUTOS_USADOS"
  name     String // p.ej. "Veh√≠culos" o "Autos Usados"
  parentId Int? // null = categor√≠a de primer nivel
  parent   CategoryNode?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children CategoryNode[] @relation("CategoryChildren")
  order    Int            @default(0)
  active   Boolean        @default(true)

  // avisos que usan esta categor√≠a (nivel que sea)
  adsCategory    Ad[] @relation("AdCategory")
  adsSubcategory Ad[] @relation("AdSubcategory")

  @@index([parentId])
  @@index([key])
}

// --- CAMBIOS EN Ad: agregamos FKs opcionales ---
model Ad {
  id          Int     @id @default(autoincrement())
  title       String
  description String
  price       Float
  imageKey    String?
  imageKeys   Json?

  // Enum original (lo mantenemos por retrocompat)
  category    Category @default(OTROS)
  subcategory String?  @db.VarChar(64)

  // NUEVO: referencias a taxonom√≠a en BD
  categoryId     Int?
  categoryRef    CategoryNode? @relation("AdCategory", fields: [categoryId], references: [id])
  subcategoryId  Int?
  subcategoryRef CategoryNode? @relation("AdSubcategory", fields: [subcategoryId], references: [id])

  // Atributos AUTOS
  brand        String?
  model        String?
  year         Int?
  mileage      Int?
  transmission Transmission?
  fuel         Fuel?
  location     String?

  userId Int
  user   User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([subcategoryId])
}
